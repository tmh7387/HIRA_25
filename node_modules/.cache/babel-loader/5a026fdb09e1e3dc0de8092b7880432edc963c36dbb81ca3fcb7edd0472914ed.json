{"ast":null,"code":"import { create } from 'zustand';\nimport { supabase } from '../services/supabase';\nconst useProjectStore = create((set, get) => ({\n  projects: [],\n  currentProject: null,\n  currentStep: 0,\n  isLoading: false,\n  error: null,\n  setCurrentProject: project => {\n    // Ensure operational_files is always an array\n    const projectWithFiles = {\n      ...project,\n      operational_files: (project === null || project === void 0 ? void 0 : project.operational_files) || []\n    };\n    set({\n      currentProject: projectWithFiles\n    });\n  },\n  setCurrentStep: step => set({\n    currentStep: step\n  }),\n  clearError: () => set({\n    error: null\n  }),\n  setLoading: isLoading => set({\n    isLoading\n  }),\n  loadProjects: async () => {\n    set({\n      isLoading: true,\n      error: null\n    });\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('hira_projects').select('*').order('created_at', {\n        ascending: false\n      });\n      if (error) throw error;\n\n      // Ensure operational_files is always an array for each project\n      const projectsWithFiles = (data === null || data === void 0 ? void 0 : data.map(project => ({\n        ...project,\n        operational_files: project.operational_files || []\n      }))) || [];\n      set({\n        projects: projectsWithFiles\n      });\n    } catch (error) {\n      console.error('Load projects error:', error);\n      set({\n        error: error.message\n      });\n    } finally {\n      set({\n        isLoading: false\n      });\n    }\n  },\n  createProject: async projectData => {\n    set({\n      isLoading: true,\n      error: null\n    });\n    try {\n      const formattedData = {\n        project_id: projectData.projectId,\n        title: projectData.title,\n        date: projectData.date,\n        facilitator: projectData.facilitator,\n        attendees: projectData.attendees || [],\n        operational_desc: projectData.operational_desc,\n        operational_files: projectData.operational_files || []\n      };\n      const {\n        data,\n        error\n      } = await supabase.from('hira_projects').insert([formattedData]).select().single();\n      if (error) throw error;\n      const projectWithFiles = {\n        ...data,\n        operational_files: data.operational_files || []\n      };\n      set(state => ({\n        projects: [projectWithFiles, ...state.projects],\n        currentProject: projectWithFiles\n      }));\n      return projectWithFiles;\n    } catch (error) {\n      console.error('Create project error:', error);\n      set({\n        error: error.message\n      });\n      throw error;\n    } finally {\n      set({\n        isLoading: false\n      });\n    }\n  },\n  updateProject: async (projectId, projectData) => {\n    set({\n      isLoading: true,\n      error: null\n    });\n    try {\n      // Get the current project to get its ID\n      const currentProject = get().currentProject;\n      if (!(currentProject !== null && currentProject !== void 0 && currentProject.id)) {\n        throw new Error('Project ID not found');\n      }\n      const formattedData = {\n        title: projectData.title,\n        date: projectData.date,\n        facilitator: projectData.facilitator,\n        attendees: projectData.attendees || [],\n        operational_desc: projectData.operational_desc,\n        operational_files: projectData.operational_files || []\n      };\n\n      // Use the database ID (id) instead of project_id for the update\n      const {\n        data,\n        error\n      } = await supabase.from('hira_projects').update(formattedData).eq('id', currentProject.id) // Use 'id' instead of 'project_id'\n      .select().single();\n      if (error) throw error;\n      const projectWithFiles = {\n        ...data,\n        operational_files: data.operational_files || []\n      };\n      set(state => ({\n        projects: state.projects.map(p => p.id === currentProject.id ? projectWithFiles : p),\n        currentProject: projectWithFiles\n      }));\n      return projectWithFiles;\n    } catch (error) {\n      console.error('Update project error:', error);\n      set({\n        error: error.message\n      });\n      throw error;\n    } finally {\n      set({\n        isLoading: false\n      });\n    }\n  },\n  deleteProject: async projectId => {\n    set({\n      isLoading: true,\n      error: null\n    });\n    try {\n      const currentProject = get().currentProject;\n      if (!(currentProject !== null && currentProject !== void 0 && currentProject.id)) {\n        throw new Error('Project ID not found');\n      }\n      const {\n        error\n      } = await supabase.from('hira_projects').delete().eq('id', currentProject.id);\n      if (error) throw error;\n      set(state => ({\n        projects: state.projects.filter(p => p.id !== currentProject.id),\n        currentProject: null\n      }));\n    } catch (error) {\n      console.error('Delete project error:', error);\n      set({\n        error: error.message\n      });\n      throw error;\n    } finally {\n      set({\n        isLoading: false\n      });\n    }\n  }\n}));\nexport default useProjectStore;","map":{"version":3,"names":["create","supabase","useProjectStore","set","get","projects","currentProject","currentStep","isLoading","error","setCurrentProject","project","projectWithFiles","operational_files","setCurrentStep","step","clearError","setLoading","loadProjects","data","from","select","order","ascending","projectsWithFiles","map","console","message","createProject","projectData","formattedData","project_id","projectId","title","date","facilitator","attendees","operational_desc","insert","single","state","updateProject","id","Error","update","eq","p","deleteProject","delete","filter"],"sources":["C:/Users/tmh73/Aviation Synergy/MaXwell AI - General/HIRA_AppBolt/src-new/src/stores/projectStore.js"],"sourcesContent":["import { create } from 'zustand';\r\nimport { supabase } from '../services/supabase';\r\n\r\nconst useProjectStore = create((set, get) => ({\r\n  projects: [],\r\n  currentProject: null,\r\n  currentStep: 0,\r\n  isLoading: false,\r\n  error: null,\r\n\r\n  setCurrentProject: (project) => {\r\n    // Ensure operational_files is always an array\r\n    const projectWithFiles = {\r\n      ...project,\r\n      operational_files: project?.operational_files || []\r\n    };\r\n    set({ currentProject: projectWithFiles });\r\n  },\r\n  \r\n  setCurrentStep: (step) => set({ currentStep: step }),\r\n  clearError: () => set({ error: null }),\r\n  setLoading: (isLoading) => set({ isLoading }),\r\n\r\n  loadProjects: async () => {\r\n    set({ isLoading: true, error: null });\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('hira_projects')\r\n        .select('*')\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      // Ensure operational_files is always an array for each project\r\n      const projectsWithFiles = data?.map(project => ({\r\n        ...project,\r\n        operational_files: project.operational_files || []\r\n      })) || [];\r\n\r\n      set({ projects: projectsWithFiles });\r\n    } catch (error) {\r\n      console.error('Load projects error:', error);\r\n      set({ error: error.message });\r\n    } finally {\r\n      set({ isLoading: false });\r\n    }\r\n  },\r\n\r\n  createProject: async (projectData) => {\r\n    set({ isLoading: true, error: null });\r\n    try {\r\n      const formattedData = {\r\n        project_id: projectData.projectId,\r\n        title: projectData.title,\r\n        date: projectData.date,\r\n        facilitator: projectData.facilitator,\r\n        attendees: projectData.attendees || [],\r\n        operational_desc: projectData.operational_desc,\r\n        operational_files: projectData.operational_files || []\r\n      };\r\n\r\n      const { data, error } = await supabase\r\n        .from('hira_projects')\r\n        .insert([formattedData])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      const projectWithFiles = {\r\n        ...data,\r\n        operational_files: data.operational_files || []\r\n      };\r\n\r\n      set((state) => ({\r\n        projects: [projectWithFiles, ...state.projects],\r\n        currentProject: projectWithFiles\r\n      }));\r\n\r\n      return projectWithFiles;\r\n    } catch (error) {\r\n      console.error('Create project error:', error);\r\n      set({ error: error.message });\r\n      throw error;\r\n    } finally {\r\n      set({ isLoading: false });\r\n    }\r\n  },\r\n\r\n  updateProject: async (projectId, projectData) => {\r\n    set({ isLoading: true, error: null });\r\n    try {\r\n      // Get the current project to get its ID\r\n      const currentProject = get().currentProject;\r\n      if (!currentProject?.id) {\r\n        throw new Error('Project ID not found');\r\n      }\r\n\r\n      const formattedData = {\r\n        title: projectData.title,\r\n        date: projectData.date,\r\n        facilitator: projectData.facilitator,\r\n        attendees: projectData.attendees || [],\r\n        operational_desc: projectData.operational_desc,\r\n        operational_files: projectData.operational_files || []\r\n      };\r\n\r\n      // Use the database ID (id) instead of project_id for the update\r\n      const { data, error } = await supabase\r\n        .from('hira_projects')\r\n        .update(formattedData)\r\n        .eq('id', currentProject.id) // Use 'id' instead of 'project_id'\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      const projectWithFiles = {\r\n        ...data,\r\n        operational_files: data.operational_files || []\r\n      };\r\n\r\n      set((state) => ({\r\n        projects: state.projects.map((p) =>\r\n          p.id === currentProject.id ? projectWithFiles : p\r\n        ),\r\n        currentProject: projectWithFiles\r\n      }));\r\n\r\n      return projectWithFiles;\r\n    } catch (error) {\r\n      console.error('Update project error:', error);\r\n      set({ error: error.message });\r\n      throw error;\r\n    } finally {\r\n      set({ isLoading: false });\r\n    }\r\n  },\r\n\r\n  deleteProject: async (projectId) => {\r\n    set({ isLoading: true, error: null });\r\n    try {\r\n      const currentProject = get().currentProject;\r\n      if (!currentProject?.id) {\r\n        throw new Error('Project ID not found');\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from('hira_projects')\r\n        .delete()\r\n        .eq('id', currentProject.id);\r\n\r\n      if (error) throw error;\r\n\r\n      set((state) => ({\r\n        projects: state.projects.filter((p) => p.id !== currentProject.id),\r\n        currentProject: null\r\n      }));\r\n    } catch (error) {\r\n      console.error('Delete project error:', error);\r\n      set({ error: error.message });\r\n      throw error;\r\n    } finally {\r\n      set({ isLoading: false });\r\n    }\r\n  }\r\n}));\r\n\r\nexport default useProjectStore;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}